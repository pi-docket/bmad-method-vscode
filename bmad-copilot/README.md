# bmad-copilot-adapter

> Official prompt executor that enables BMAD-METHOD workflows to run natively inside GitHub Copilot Chat.

[![npm version](https://img.shields.io/npm/v/bmad-copilot-adapter)](https://www.npmjs.com/package/bmad-copilot-adapter)
<!-- [![VS Code Marketplace](https://img.shields.io/visual-studio-marketplace/v/bmad-code-org.bmad-copilot-adapter)](https://marketplace.visualstudio.com/items?itemName=bmad-code-org.bmad-copilot-adapter) -->
[![BMAD-METHOD](https://img.shields.io/badge/BMAD--METHOD-≥6.0.0-blue)](https://github.com/pi-docket/bmad-method-vscode)
[![License: MIT](https://img.shields.io/badge/License-MIT-yellow.svg)](LICENSE)

```bash
npm install bmad-copilot-adapter
```

---

## Overview

**bmad-copilot-adapter** is a VS Code extension that bridges the [BMAD-METHOD](https://github.com/pi-docket/bmad-method-vscode) command system into GitHub Copilot Chat. It reads the official `.prompt.md` and `.agent.md` files generated by the BMAD installer and passes them **directly** to the Copilot LLM — no workflow parsing, no prompt reconstruction, no token management.

```
CLI:         bmad:bmm:create-prd
Copilot:     @bmad /run bmad-bmm-create-prd
```

### What It Does

- Registers the `@bmad` chat participant with 7 slash commands
- Discovers and indexes BMAD commands from `_bmad/_config/` manifests
- Reads official prompt files and sends them **as-is** to the LLM
- Auto-mirrors `claude-code` prompt files to GitHub Copilot format
- Spawns the real BMAD CLI for `install` and `status` operations

### What It Does NOT Do

- ❌ Parse, rewrite, or transform prompt file content
- ❌ Pre-read or inline `{project-root}` file references
- ❌ Manage token budgets or truncate prompts
- ❌ Bundle, modify, or replace any part of `bmad-method`
- ❌ Replicate BMAD CLI execution logic

---

## Installation

> **Important:** Install the official BMAD-METHOD first, then the adapter.

### Step 1 — Open Your Project Folder

**Windows (PowerShell):**

```powershell
cd D:\your-project
```

**macOS / Linux:**

```bash
cd ~/your-project
```

### Step 2 — Install Official BMAD-METHOD (Required)

BMAD-METHOD must be installed in your workspace first. The adapter reads files
generated by the BMAD installer — it does not include them.

```bash
npx bmad-method install --modules bmm --tools claude-code --yes
```

This creates:
- `_bmad/` — Core framework and module files
- `_bmad/_config/` — CSV command manifests
- `_bmad/ide/claude-code/prompts/` — Prompt files (auto-mirrored to `.github/`)

> You can also use `--tools github-copilot` to generate `.github/prompts/` directly.

### Step 3 — Install the Adapter

**From npm (recommended):**

```powershell
# Install globally
npm install -g bmad-copilot-adapter

# Or install as a project dev dependency
npm install --save-dev bmad-copilot-adapter
```

> **Note:** This is a VS Code extension package. After installing from npm, you
> still need to load it in VS Code. The simplest approach is to install from the
> VS Code Marketplace (see below), which handles everything automatically.

**From VS Code Marketplace:**

Open VS Code → Extensions panel → search `BMAD Copilot Adapter`, or run:

```bash
code --install-extension bmad-code-org.bmad-copilot-adapter
```

**From VSIX (manual):**

```powershell
npx @vscode/vsce package --out releases/
code --install-extension releases/bmad-copilot-adapter-0.1.0.vsix
```

**From source (development):**

```powershell
cd bmad-copilot
npm install
npm run build
# Press F5 in VS Code to launch Extension Development Host
```

### Step 4 — Verify Installation

Open Copilot Chat (`Ctrl+Shift+I`) and type:

```
@bmad /status
```

You should see ✅ for `_bmad/` directory and GitHub Copilot prompt files.

---

## Usage

### Slash Commands

| Command | Description |
|---------|-------------|
| `@bmad /status` | Check BMAD installation health |
| `@bmad /install` | Open terminal with BMAD installer |
| `@bmad /help` | Show available commands and guidance |
| `@bmad /run <name>` | Execute any BMAD command by name |
| `@bmad /agents` | List installed BMAD agents |
| `@bmad /workflows` | List installed workflows by phase |
| `@bmad /tasks` | List installed tasks and tools |

### Examples

```
@bmad /run bmad-bmm-create-prd
@bmad /run bmad-agent-bmm-pm
@bmad /help create prd
@bmad /agents
```

### Free-text

You can also type naturally — the adapter matches your input to known commands:

```
@bmad I want to create a PRD
@bmad bmad-bmm-create-prd
```

### Windows PowerShell Quick Start

```powershell
# 1. Navigate to your project
cd D:\Projects\my-app

# 2. Install BMAD
npx bmad-method install --modules bmm --tools claude-code --yes

# 3. Open in VS Code
code .

# 4. Open Copilot Chat (Ctrl+Shift+I) and type:
#    @bmad /status
#    @bmad /run bmad-bmm-create-prd
```

---

## Command Name Mapping

BMAD CLI uses colons (`:`), Copilot Chat uses dashes (`-`):

| CLI Syntax | Copilot Chat |
|------------|--------------|
| `bmad:bmm:create-prd` | `@bmad /run bmad-bmm-create-prd` |
| `bmad:agent:bmm:pm` | `@bmad /run bmad-agent-bmm-pm` |
| `bmad:help` | `@bmad /help` |

---

## Configuration

| Setting | Default | Description |
|---------|---------|-------------|
| `bmad.bmadDir` | `""` | Override path to `_bmad/` (auto-detected if empty) |
| `bmad.autoScan` | `true` | Scan commands on extension activation |
| `bmad.verbose` | `false` | Verbose logging to BMAD output channel |

---

## Architecture

This extension follows the **Official Prompt Executor** model:

```
extension.ts          → Lifecycle, activation, prompt mirror, watchers
  ├─ promptMirror.ts  → claude-code → Copilot prompt file mirror
  └─ chatBridge.ts    → Prompt executor, slash command routing
       ├─ commandRegistry.ts  → CSV scanning, prompt file mapping
       ├─ cliBridge.ts        → CLI process spawner (install/status)
       └─ bmadRuntime.ts      → @deprecated legacy fallback
```

### Execution Flow

```
@bmad /run X  → find .github/prompts/X.prompt.md
              → (if missing, auto-mirror from _bmad/ide/claude-code/)
              → read file, strip YAML frontmatter
              → pass body AS-IS to Copilot LLM
              → LLM reads {project-root} files via workspace context
```

### Design Principles

1. **Strict upstream alignment** — only reads files produced by the official BMAD installer.
2. **No prompt reconstruction** — prompt body is passed unmodified to the LLM.
3. **No workflow parsing** — the LLM interprets workflow instructions, matching native Copilot behavior.
4. **No bundling** — `bmad-method` is a peer dependency, never included in the package.

See [ARCHITECTURE.md](ARCHITECTURE.md) for the full architecture document.

---

## Prompt Mirror (claude-code → Copilot)

If BMAD was installed with `--tools claude-code`, the adapter automatically
mirrors prompt files from `_bmad/ide/claude-code/` to `.github/prompts/`
on activation. This is a **file copy with minimal transformation**:

- Filename colons → dashes (`bmad:bmm:create-prd.prompt.md` → `bmad-bmm-create-prd.prompt.md`)
- Frontmatter `command:` → `name:` (colons → dashes)
- Body content is **never modified**
- Existing files are **never overwritten**

No Cloud Code CLI is required — only the generated prompt files.

---

## Development

```bash
git clone https://github.com/pi-docket/bmad-method-vscode.git
cd bmad-method-vscode
npm install
npm run build
```

Press `F5` in VS Code to launch the Extension Development Host.

### Scripts

| Script | Description |
|--------|-------------|
| `npm run build` | Clean build to `dist/` |
| `npm run compile` | TypeScript compile only |
| `npm run watch` | Compile in watch mode |
| `npm run lint` | Type-check without emitting |
| `npm run vsce:package` | Build VSIX package to `releases/` |
| `npm run vsce:publish` | Publish to VS Code Marketplace |
| `npm run release` | Build + publish to npm |

---

## Publishing & Versioning

This project follows [Semantic Versioning](https://semver.org/):

| Version Bump | When |
|---|---|
| `patch` (0.1.0 → 0.1.1) | Bug fixes, documentation updates |
| `minor` (0.1.0 → 0.2.0) | New features, new slash commands |
| `major` (0.x → 1.0.0) | Breaking changes, API changes |

### Release Process

```powershell
# 1. Bump version and tag
npm version patch -m "release: %s"

# 2. Build
npm run build

# 3. Publish to npm (use --ignore-scripts to avoid rebuild timeout with 2FA)
npm publish --access public --ignore-scripts

# 4. Push tag to trigger GitHub Actions CI
git push --follow-tags

# 5. (Optional) Publish VSIX to VS Code Marketplace
npx @vscode/vsce publish
```

> **2FA Users:** If your npm account has 2FA enabled, create a
> [Granular Access Token](https://www.npmjs.com/settings/~/tokens/granular-access-tokens/new)
> with publish permission for `bmad-copilot-adapter`. Set it via:
> ```powershell
> npm config set //registry.npmjs.org/:_authToken=npm_YOUR_TOKEN
> ```

Or use the included release scripts:

```powershell
# Windows
.\scripts\release.ps1 -Bump patch

# macOS / Linux
./scripts/release.sh patch
```

### CI/CD

GitHub Actions automatically builds and publishes on version tags (`v*`).
Configure the following repository secrets:

| Secret | Source | Purpose |
|--------|--------|---------|
| `NPM_TOKEN` | [npmjs.com → Access Tokens](https://www.npmjs.com/settings/~/tokens) | npm publish |
| `VSCE_PAT` | [Azure DevOps → Personal Access Tokens](https://dev.azure.com) | VS Code Marketplace publish |

See [.github/workflows/release.yml](.github/workflows/release.yml).

---

## Folder Structure

### Source (development)

```
bmad-copilot/
├── .github/workflows/release.yml
├── .vscode/launch.json, tasks.json
├── src/
│   ├── extension.ts
│   ├── chatBridge.ts
│   ├── cliBridge.ts
│   ├── commandRegistry.ts
│   ├── promptMirror.ts
│   ├── bmadRuntime.ts
│   └── types.ts
├── package.json
├── tsconfig.json
├── README.md
├── ARCHITECTURE.md
├── TESTING.md
└── LICENSE
```

### Published (npm / VSIX)

```
bmad-copilot-adapter/
├── dist/
│   ├── extension.js
│   ├── chatBridge.js
│   ├── cliBridge.js
│   ├── commandRegistry.js
│   ├── promptMirror.js
│   ├── bmadRuntime.js
│   └── types.js
├── package.json
├── README.md
├── ARCHITECTURE.md
└── LICENSE
```

No `src/`, no `node_modules/`, no source maps, no dev files.

---

## Safety & Disclaimer

- This package **does not modify** any files in `_bmad/` or `.github/`.
- It **does not bundle** any part of `bmad-method`.
- It **only reads** official prompt files and forwards them to the Copilot LLM.
- Users **must install** `bmad-method` separately — it is a peer dependency.
- No internal workflow logic, config merging, or CLI execution is replicated.
- The prompt mirror creates `.github/prompts/` files only when they don't already exist.

---

## Compatibility

| Requirement | Minimum Version |
|---|---|
| VS Code | ≥ 1.93.0 |
| Node.js | ≥ 18.0.0 |
| BMAD-METHOD | ≥ 6.0.0-Beta.1 |
| GitHub Copilot Chat | Required (extension must be active) |

**Platform support:** Windows, macOS, Linux.

---

## License

MIT — see [LICENSE](LICENSE) for details.

This package is an independent adapter. It does not include, fork, or modify any
part of the upstream [BMAD-METHOD](https://github.com/pi-docket/bmad-method-vscode)
codebase. Refer to the BMAD-METHOD repository for its own license terms.
